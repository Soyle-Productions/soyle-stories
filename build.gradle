buildscript {
    apply from: "$LIBRARIES"

    def props = new Properties()
    props.load(project.rootProject.file('local-properties.properties').newDataInputStream())
    props.each { key, value -> ext.set(key, value) }
}


plugins {
    id 'org.jetbrains.kotlin.jvm' version "$KOTLIN_VERSION"
    id "com.github.breadmoirai.github-release" version "$GITHUB_RELEASE_VERSION"
}

allprojects {
    repositories {
        jcenter()
        mavenCentral()
    }
}

subprojects { project ->

    group = GROUP
    version = VERSION_NAME

    archivesBaseName = ARTIFACT_ID

    tasks.withType(Test) {
        maxParallelForks = Runtime.runtime.availableProcessors()
    }

    sourceCompatibility = JAVA_VERSION
    targetCompatibility = JAVA_VERSION

}

wrapper {
    gradleVersion = "6.3"
    distributionType = Wrapper.DistributionType.ALL
}

task buildAndPackage {
    group = "Soyle Tasks"
    description = "Create runtime images for all three platforms"

    configure {
        dependsOn(":infrastructure:runtimeZip")
    }
}

apply from: 'publish-conf.gradle'

configure(subprojects) {
    apply plugin: 'java'
    apply plugin: 'org.jetbrains.kotlin.jvm'
    dependencies {
        implementation libraries.kotlin
        testImplementation libraries.junit
    }

    compileKotlin {
        kotlinOptions.jvmTarget = JAVA_VERSION
    }
    compileTestKotlin {
        kotlinOptions.jvmTarget = JAVA_VERSION
    }

}